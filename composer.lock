#!/bin/bash

# Script to update Laravel dependencies and regenerate composer.lock
set -e

echo "ğŸ”§ Updating Laravel dependencies..."

# Backup current composer.lock
if [ -f "composer.lock" ]; then
    cp composer.lock composer.lock.backup
    echo "ğŸ“‹ Backed up composer.lock"
fi

# Clear composer cache
composer clear-cache

# Update dependencies
echo "ğŸ“¦ Updating Composer packages..."
composer update --prefer-dist --no-interaction

# Optimize autoload
echo "âš¡ Optimizing autoload..."
composer dump-autoload -o

# Run Laravel optimizations
if [ -f "artisan" ]; then
    echo "ğŸ› ï¸ Running Laravel optimizations..."
    php artisan optimize:clear
    php artisan optimize
    php artisan package:discover
fi

echo "âœ… Dependencies updated successfully!"
echo "ğŸ“‹ Changes summary:"
composer show --latest

# Compare with backup
if [ -f "composer.lock.backup" ]; then
    echo "ğŸ“Š Differences from previous lock file:"
    diff composer.lock composer.lock.backup || true
fi
